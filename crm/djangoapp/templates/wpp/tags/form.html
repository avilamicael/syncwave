{% extends 'base.html' %}

{% block title %}
    {% if object %}Editar Tag{% else %}Nova Tag{% endif %} - WhatsApp
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{% url 'wpp:dashboard' %}">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
        </li>
        <li class="breadcrumb-item">
            <a href="{% url 'wpp:tag_list' %}">Tags</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            {% if object %}Editar{% else %}Nova{% endif %}
        </li>
    </ol>
</nav>

<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <div>
        <h1 class="h3 mb-0 text-gray-800">
            {% if object %}Editar Tag{% else %}Nova Tag{% endif %}
        </h1>
        <p class="mb-0 text-muted">
            {% if object %}
                Atualize as informações da tag "{{ object.nome }}"
            {% else %}
                Crie uma nova tag para organizar seus contatos
            {% endif %}
        </p>
    </div>
</div>

<div class="row">
    <!-- Form Card -->
    <div class="col-lg-8">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    {% if object %}Editar Tag{% else %}Nova Tag{% endif %}
                </h6>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            <h6 class="font-weight-bold">Ocorreram erros:</h6>
                            <ul class="mb-0">
                                {% for error in form.non_field_errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}

                    <div class="row">
                        <!-- Nome -->
                        <div class="col-lg-12 mb-4">
                            <label for="{{ form.nome.id_for_label }}" class="form-label font-weight-bold">
                                {{ form.nome.label }}
                                <span class="text-danger">*</span>
                            </label>
                            {{ form.nome }}
                            {% if form.nome.help_text %}
                                <small class="form-text text-muted">{{ form.nome.help_text }}</small>
                            {% endif %}
                            {% if form.nome.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.nome.errors %}
                                        <div>{{ error }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Cor -->
                        <div class="col-lg-6 mb-4">
                            <label for="{{ form.cor.id_for_label }}" class="form-label font-weight-bold">
                                {{ form.cor.label }}
                            </label>
                            <div class="d-flex align-items-center">
                                {{ form.cor }}
                                <div class="ml-3 preview-color-container">
                                    <div class="badge badge-secondary preview-color" 
                                         style="background-color: {{ form.cor.value|default:'#6B7280' }}; color: white;">
                                        Preview
                                    </div>
                                </div>
                            </div>
                            {% if form.cor.help_text %}
                                <small class="form-text text-muted">{{ form.cor.help_text }}</small>
                            {% endif %}
                            {% if form.cor.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.cor.errors %}
                                        <div>{{ error }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Actions -->
                    <hr>
                    <div class="text-right">
                        <a href="{% url 'wpp:tag_list' %}" 
                           class="btn btn-secondary mr-2">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                        <button type="submit" 
                                class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            {% if object %}Atualizar Tag{% else %}Criar Tag{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Preview Card -->
    <div class="col-lg-4">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-eye mr-2"></i>Preview da Tag
                </h6>
            </div>
            <div class="card-body text-center">
                <div class="mb-3">
                    <span id="tag-preview" class="badge badge-lg" 
                          style="background-color: {{ form.cor.value|default:'#6B7280' }}; color: white; font-size: 1rem; padding: 0.5rem 1rem;">
                        <i class="fas fa-tag mr-1"></i>
                        <span class="tag-preview-text">{{ form.nome.value|default:'Nome da Tag' }}</span>
                    </span>
                </div>
                <p class="small text-muted mb-0">
                    Assim sua tag aparecerá nos contatos
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    const nomeInput = $('#{{ form.nome.id_for_label }}');
    const corInput = $('#{{ form.cor.id_for_label }}');
    const tagPreview = $('#tag-preview');
    const tagPreviewText = $('.tag-preview-text');
    const previewColor = $('.preview-color');
    
    function updatePreview() {
        const nome = nomeInput.val() || 'Nome da Tag';
        const cor = corInput.val() || '#6B7280';
        
        tagPreviewText.text(nome);
        tagPreview.css('background-color', cor);
        previewColor.css('background-color', cor);
    }
    
    if (nomeInput.length && corInput.length) {
        nomeInput.on('input', updatePreview);
        corInput.on('input change', updatePreview);
        
        // Update preview on page load
        updatePreview();
    }
});
</script>
<style>
input[type="color"] {
    width: 50px !important;
    height: 38px !important;
    padding: 0 !important;
    border-radius: 0.25rem;
    cursor: pointer;
}
</style>
{% endblock %}
